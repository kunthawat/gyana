<!-- https://docs.djangoproject.com/en/2.2/_modules/django/forms/boundfield/#BoundField -->
{% if form.form_description %}
<div class="form__description">{{ form.form_description }}</div>
{% endif %}

<div class="input-group">
{% for bound_field in form.visible_fields %}
  {% if bound_field.name in form.extra_fields %}
  {% elif bound_field.widget_type == "palettecolors" %}
    <div class="label">
      <label>
        <span class="block">
          {{ bound_field.label }}

          {% if bound_field.help_text %}
          <p class="input__help-text">{{ bound_field.help_text }}</p>
          {% endif %}
        </span>
      </label>

      <div class="palette-colors">{{ bound_field }}</div>
    </div>
    {{ bound_field.errors }}
  {% elif bound_field.widget_type == "connectorschemamultiselect" %}
    <div
      data-controller="multi-select"
      class="w-full {{ bound_field.field.widget.attrs.class }}"
    > 
      <div class="flex items-center gap-2 flex-row float-right">
        <p class="text-black-50 small">Select:</p>
        <a
          class="link small"
          data-action="click->multi-select#checkAllInputs"
        >
          All
        </a>
        <p>|</p>
        <a
          class="link small"
          data-action="click->multi-select#uncheckAllInputs"
        >
          None
        </a>
      </div>

      <label>
        {{ bound_field.label }}

        {% if bound_field.help_text %}
        <p class="input__help-text">{{ bound_field.help_text }}</p>
        {% endif %}
      </label>

      {{ bound_field }}
    </div>
    {{ bound_field.errors }}
  {% elif bound_field.widget_type == "radioselect" %}
    <div class="{{ bound_field.field.widget.attrs.class }}">
      <label class="block mb-2">
        {{ bound_field.label }}

        {% if not bound_field.field.required and not optional == False %}
        <span class="text-black-50">- optional</span>
        {% endif %}
    
        {% if bound_field.help_text %}
        <p class="input__help-text">
          {{ bound_field.help_text }}
          {% if not bound_field.field.required %} - optional{% endif %}
        </p>
        {% endif %}
      </label>
    
      {{ bound_field }}
    </div>
    {{ bound_field.errors }}
  {% elif bound_field.widget_type == "checkbox" %}
    <label  
      class="flex flex-row items-center gap-4 w-full"
      {% if bound_field.name == 'DELETE' %}style="display: none;"{% endif %}
    >
      {{ bound_field }}
      
      <span>
        {{ bound_field.label }}

        {% if bound_field.help_text %}
        <p class="input__help-text">{{ bound_field.help_text }}</p>
        {% endif %}
      </span>
    </label>
    {{ bound_field.errors }}
  {% elif bound_field.subwidgets|length == 1 and bound_field.widget_type != "codemirror" and bound_field.widget_type != "textareacode" %}
    <div
      {% if bound_field.field.initial %}
      data-controller="reset-default"
      data-reset-default-initial-value="{{ bound_field.field.initial }}"
      {% endif %}
      class="label {{ bound_field.field.widget.attrs.class }}"
    > 
      <label for="{{ bound_field.id_for_label}}">
        <span class="block">
          {{ bound_field.label }}

          {% if not bound_field.field.required and not optional == False %}
          <span class="text-black-50">- optional</span>
          {% endif %}

          <a
            class="small link float-right"
            data-reset-default-target="control"
            hidden
          >
            Reset to default
          </a>
          
          {% if bound_field.help_text %}
          <p class="input__help-text">{{ bound_field.help_text }}</p>
          {% endif %}
        </span>
      </label>

      <div class="flex flex-row-reverse mt-auto">
        {% if bound_field.field.widget.attrs.unit_suffix %}
        <div class="label__unit">
          <p>{{ bound_field.field.widget.attrs.unit_suffix }}</p>
        </div>
        {% endif %}

        {{ bound_field }}
      </div>
    </div>
    {{ bound_field.errors }}
  {% else %}
    {% include 'django/forms/field.html' with field=bound_field%}
  {% endif %}

  {% endfor %}

  {% if form.extra_fields %}
  <details class="form__extra">
    <summary>
      <p class="link small cursor-pointer">
        <i class="fas fa-fw fa-angle-down"></i>Advanced
      </p>
    </summary>

    <div
      class="input-group"
    >
      {% for bound_field in form.visible_fields  %}
        {% if bound_field.name in form.extra_fields %}
          {% include "django/forms/field.html" with field=bound_field %}
        {% endif %}
      {% endfor %}
    </div>
  </details>
  {% endif %}


</div>

{% for label, formset in form.get_formsets.items %}
<fieldset>
  <label>{{ label }}</label>
  {% include "components/formset.html" with formset=formset %}
</fieldset>
{% endfor %}

{% for error in form.non_field_errors %}
<p class="text-red">
  {{ error|escape }}
</p>
{% endfor %}

{% for hidden_field in form.hidden_fields %}
{{ hidden_field }}
{% endfor %}

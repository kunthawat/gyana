{% extends "web/app/project_settings_base.html" %}
{% load static %}
{% load help_utils %}

{% block app %}

{% if not request.GET.service %}

  <div class="flex flex-row flex-1 overflow-hidden">
    <div class='flex flex-col flex-1 overflow-auto'>
      <h2 class="pad">
        Choose a connector
        {% link_article 'integrations' 'connector' %}
        {% link_video 'connector' %}
      </h2>
      <div class='flex flex-col flex-1'>  
          <div class="flex flex-wrap gap-16 pad">
              {% for category in service_categories %}
              <div class="flex flex-col gap-7">
                  <h3>{{ category|capfirst }}</h3>
                  <div class="flex flex-1 flex-wrap content-start gap-7">
                  {% for service_id, service in services.items %}
                      {% if service.type == category %}
                        {% if service.internal != 't' or request.user.is_superuser %}
                          <a class="card card--inline card--square"
                            href="{% url 'project_integrations_connectors:create' project.id %}?service={{ service_id }}">
                            <div class="flex-1">
                                <img style="height:4.2rem;" src="{% static 'images/integrations/fivetran/'|add:service.icon_path %}"
                                    alt="{{ service.name }}" />
                            </div>
                            <span class="flex-1">{{ service.name }}</span>
                          </a>
                        {% endif %}
                      {% endif %}
                  {% endfor %}
                  </div>
              </div>
              {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

{% else %}
  
  {% with services|dict_key:request.GET.service as service %}

  <div class="flex flex-1 justify-center items-center">
    <div class="flex flex-col max-w-3xl">
      <h2 class="mb-4">
        Add a new connector
        {% link_article 'integrations' 'connector' %}
        {% link_video 'connector' %}
      </h2>
      <div class="card mb-4">
        <div class="flex flex-col text-center mb-7">
          <img class="h-20 mb-2" src="{% static 'images/integrations/fivetran/'|add:service.icon_path %}"
              alt="{{ service.name }}" />
          {% comment %} <p>Create a new connector to</p> {% endcomment %}
          <h1 class="mb-2">{{ service.name }}</h1>
          <p class="max-w-xl">{{ service.description }}</p>
        </div>
      </div>

      <p>
        You'll now be redirected to <strong>Fivetran</strong> to
        setup your integration. Learn more about our <a class="link" href="{% article_url 'integrations' 'connector' %}">partnership with Fivetran</a>.
      </p>

      <p class="mb-4">
        They'll ask you to authorise <strong>{{ service.name }}</strong> and configure your connection settings.
        Fivetran will run checks to validate and re-direct to us if successful.
        Any issues, take a look at our <a class="link" href="{% article_url 'integrations' 'error' %}">troubleshooting guide<a/>.
      </p>

      <p class="alert mb-4">
        You can revoke our access to your data at any time.
      </p>

      <p>
        The intial import will take from a few minutes to an hour. You'll get an email
        when it's ready to review, or you can keep an eye on the <a class="link" href="{% url 'project_integrations:pending' project.id %}">pending integrations</a> page.
      </p>

      <p class="alert mb-6">
        After the initial import, new data will sync into Gyana automatically.
      </p>
      
      <form id="create-form" method="post" action="{{ request.get_full_path }}" class="form max-w-xl" data-turbo="false">
        {% csrf_token %}

        {% include "django/forms/default_form.html" %}

        <button type="submit" class="button button--success">
          Continue
        </button>
      </form>
    </div>
  </div>

  {% endwith %}

{% endif %}

{% endblock %}

{% extends "teams/base.html" %}
{% load humanize %}
{% load help_utils %}
{% load waffle_tags %}

{% block tab %}
<section class="account">
  <h2 class="mb-7">Billing</h2>

  <div class="card card--none max-w-xl mb-4 flex flex-col space-y-4">
    <div class="pad flex flex-col space-y-2">
      <h2>Plan</h2>
      <p class="text-blue">
        {% if team.has_subscription %}Gyana{% endif %} {{ team.plan.name }}
      </p>
      {% if team.is_free %}
        <a href="{% url 'teams:plan' team.id %}" class="button button--sm button--success">Upgrade your plan</a>
        <p>
          Upgrade to the Pro plan or Business plan and get access to more rows, advanced security features and 
          <a href="https://gyana.com/pricing" class="link">more...</a>
        </p>
      {% endif %}
    </div>
    {% flag 'subscriptions' %}
      {% if team.has_subscription %}
        <table class="table">
          <tbody>
            <tr>
              <td><h3>Next renewal on</h3></td>
              <td>
                <p>{{ team.active_subscription.next_bill_date|date:'M d, Y' }}</p>
              </td>
            </tr>
            <tr>
              <td><h3>Invoices sent to</h3></td>
              <td>
                <p>{{ team.active_subscription.email }}</p>
              </td>
            </tr>
            <tr>
              <td>
                <a href="{% url 'teams:subscription' team.id %}" class="link" data-turbo="false">
                  Manage Subscription
                </a>
              </td>
            </tr>
            <tr>
              <td>
                <a href="{% url 'teams:payments' team.id %}" class="link" data-turbo="false">
                  View Payments & Receipts
                </a>
              </td>
            </tr>
            <tr>
              <td>
                <a href="{{ team.active_subscription.update_url }}" class="link" data-turbo="false">
                  Update Payment Method
                </a>
              </td>
            </tr>
          </tbody>
        </table>
        {% endif %}
    {% endflag %}
  </div>
  
  <div class="account__plan">
    <div class="card card--none">
      <table class="table">
        <tbody>
          <tr>
            <td><h3>Rows used</h3></td>
            <td>
              <span class="flex items-center">
                <span class="mr-3">{{ team.row_count|intcomma }} / {{ team.row_limit|intcomma }}</span>
                <form method="post" class="form--no-layout">
                  {% csrf_token %}

                  {% include "django/forms/default_form.html" %}

                  <button type="submit" class="button button--circle button--sm button--tertiary" data-controller="tooltip">
                    <i class="fas fa-fw fa-sync-alt"></i>
                    <span data-tooltip-target="body">Calculate row usage</span>
                  </button>
                </form>
              </span>
            </td>
          </tr>
          <tr>
            <td><h3>Credits spent</h3></td>
            <td class="flex items-center">
              <span class="mr-3">{{ team.current_credit_balance|intcomma }} / {{ team.credits|intcomma }}</span>
              {% link_article 'overview' 'credits' %}
            </td>
          </tr>

          <tr>
            <td><h3>Projects</h3></td>
            <td>{{ team.total_projects }} / {% if team.plan.projects != -1 %}{{ team.plan.projects }}{% else %}∞{% endif %}</td>
          </tr>

          <tr>
            <td><h3>Users</h3></td>
            <td>∞</td>
          </tr>

          <tr>
            <td><h3>Views</h3></td>
            <td>∞</td>
          </tr>

          <tr>
            <td><h3>Chat support</h3></td>
            <td><i class="fa fa-check text-green"></i></td>
          </tr>

          {% if team.plan.custom_branding %}
            <tr>
              <td><h3>Custom branding</h3></td>
              <td><i class="fa fa-check text-green"></i></td>
            </tr>
          {% endif %}

          {% if team.plan.cnames %}
            <tr>
              <td><h3>Custom domains</h3></td>
              <td>{{ team.total_cnames }} / {% if  team.plan.cnames != -1 %}{{ team.plan.cnames }}{% else %}∞{% endif %}</td>
            </tr>
          {% endif %}

          {% if team.plan.sub_accounts %}
            <tr>
              <td><h3>Sub Accounts</h3></td>
              <td>{{ team.total_invite_only_projects }} / {% if  team.plan.sub_accounts != -1 %}{{ team.plan.sub_accounts }}{% else %}∞{% endif %}</td>
            </tr>
          {% endif %}

          {% if team.plan.white_labeling %}
            <tr>
              <td><h3>White labeling</h3></td>
              <td><i class="fa fa-check text-green"></i></td>
            </tr>
          {% endif %}

        </tbody>
      </table>
    </div>
  </div>

  {% if team.appsumocode_set.count > 0 %}
  <div id="appsumo-list" class="mt-7">
    <h2 class="mb-3">AppSumo</h2>

    <turbo-frame id="team_appsumo:list" src="{% url 'team_appsumo:list' team.id %}"></turbo-frame>
  </div>
  {% endif %}
</section>
{% endblock %}
